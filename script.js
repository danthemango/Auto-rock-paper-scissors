
const scissorImgStr = `
    <svg xmlns="http://www.w3.org/2000/svg" width="110" height="60">
        <linearGradient id="lg1">
            <stop offset="0" style="stop-color:#3a393d;stop-opacity:1" />
            <stop style="stop-color:#7f7e85;stop-opacity:1" offset="0.45323682"/>
            <stop offset="1" style="stop-color:#eeeef0;stop-opacity:1" />
        </linearGradient>
        <linearGradient gradientTransform="translate(-40.159054,12.348416)" gradientUnits="userSpaceOnUse"
        y2="32.475651" x2="30.76417" y1="35.187626" x1="31.946936" id="lg2" />
        <path 
            d="m 7.4275061,49.226551 c -0.9507818,1.111098 -1.712243,2.906357 -1.712243,2.906357 0,0 2.0645478,-0.893638 3.0733838,-1.390106 4.4570961,-2.193421 11.3772021,-5.982803 13.1500241,-7.011991 3.91827,-2.274701 7.973992,-5.056116 11.521742,-7.8572 2.412061,-1.904413 3.872138,-4.258311 6.31168,-5.949622 1.658859,-1.150069 3.772039,-1.394209 5.719706,-1.239229 1.947666,0.154981 4.891844,0.173039 8.63018,-4.206532 3.738337,-4.379571 1.263312,-6.687024 -0.661268,-7.880259 -1.92458,-1.193234 -5.598819,0.501343 -6.722495,1.382381 -1.123676,0.881039 -3.173153,3.157172 -3.644547,4.599485 -0.471387,1.442318 -1.155522,2.17846 -3.329404,4.37938 -0.892646,0.903747 -1.843208,1.56532 -2.631038,2.094061 -1.248795,0.838112 -2.805098,1.335661 -3.890316,2.080678 0,0 -3.120283,2.221192 -4.734396,3.250227 -1.067998,0.680873 -2.200287,1.256834 -3.271697,1.932324 -3.504766,2.20965 -6.975893,4.481877 -10.317475,6.931322 -2.576856,1.888888 -6.5410501,4.867629 -7.4918369,5.978724 z M 45.651417,20.908222 c 0.712352,-0.901901 1.566162,-1.775776 2.329473,-2.203913 1.526622,-0.856276 4.251507,-1.731209 5.556084,-0.60865 1.304574,1.122562 0.909712,2.203114 0.777818,3.112527 -0.131894,0.909412 -0.824874,2.661274 -2.891259,4.377336 -1.950354,1.619703 -2.989697,1.657788 -4.50975,1.737055 -2.436267,0.127047 -3.317508,-2.416074 -2.743023,-4.042232 0.191607,-0.54237 0.768307,-1.47022 1.480657,-2.372123 z"
            style="opacity:1;fill:#b5b4b9;fill-opacity:1;stroke:none;stroke-width:0.4;stroke-miterlimit:4;stroke-dasharray:none"
            id="path861" />
        <path 
            d="m 33.720413,6.1892711 c -0.344659,0.4449713 -0.686483,0.9793966 -1.022793,1.6157562 -2.690489,5.0908817 -1.448348,7.7586577 -0.724172,9.5733177 0.928369,2.326341 1.170253,4.175539 0.720922,6.539586 -0.899694,4.733523 -3.370981,8.978075 -5.791169,13.12287 0,0 0.48659,0.811612 0.575103,1.589508 0.08851,0.777893 -0.778324,2.1635 -1.111208,2.700426 -0.332892,0.53692 -3.989378,6.258729 -3.989378,6.258729 10e-7,0 -4.148887,6.933036 -4.647911,7.856577 -0.499024,0.923542 -1.980458,3.140881 -2.377011,3.579983 -0.396553,0.439102 -1.229654,1.426726 -1.229654,1.426726 0.136742,0.108803 10.900466,-12.739214 11.652353,-13.933203 0.747592,-1.187167 7.700342,-11.040465 7.700342,-11.040465 0,0 -0.133906,-3.089525 0.377343,-6.713195 0.354869,-2.515261 0.970673,-5.801085 1.700816,-7.46781 1.241297,-2.833549 1.66768,-2.792836 2.834161,-3.763303 1.166476,-0.970468 2.669659,-3.89613 3.073732,-5.265656 0.404074,-1.369525 0.622654,-5.410079 -1.196694,-6.7583324 -1.59193,-1.1797224 -4.13216,-2.4363085 -6.544782,0.6784855 z m 0.457691,1.5951445 c 0.546681,-0.6991833 1.08917,-1.1364606 1.487429,-1.3655858 0.796515,-0.4582485 1.654976,-1.22391 3.179794,-0.4257959 1.524818,0.7981172 1.849713,3.6763601 1.485072,5.3883251 -0.416126,1.953684 -1.312376,3.868761 -2.846479,5.229871 -1.290081,1.144604 -3.988409,1.254047 -4.769569,-1.057084 -0.487386,-1.441977 -0.835162,-2.422191 -0.04971,-4.832666 0.416087,-1.2769381 0.966784,-2.2378835 1.513463,-2.9370644 z"
            style="opacity:1;fill:#c1c3bc;fill-opacity:1;stroke:none;stroke-width:0.4;stroke-miterlimit:4;stroke-dasharray:none"
            id="path863" />
        <path id="path872"
            style="opacity:1;fill:#e7e6e2;fill-opacity:1;stroke:none;stroke-width:0.4;stroke-miterlimit:4;stroke-dasharray:none"
            d="m 26.903201,37.040801 c 0,0 -0.08129,0.63665 -0.194585,0.946701 -0.113302,0.310053 -2.196278,3.38894 -2.874118,4.450412 -0.677842,1.061469 -4.36329,6.866825 -6.541291,10.903436 -2.148776,3.982449 -3.031708,6.898 -3.055256,6.976237 0.163108,-0.192964 0.767149,-0.906559 1.114845,-1.291563 0.396553,-0.439102 1.877987,-2.656441 2.377011,-3.579983 0.499024,-0.923541 4.647912,-7.856577 4.647911,-7.856577 0,0 3.656486,-5.721809 3.989378,-6.258729 0.332884,-0.536926 1.199717,-1.922533 1.111208,-2.700426 -0.08851,-0.777896 -0.575103,-1.589508 -0.575103,-1.589508 z" />
        <path
            d="m 26.903201,37.040801 c 0,0 -2.372356,3.432805 -5.511567,8.488841 -3.139214,5.056035 -3.285037,5.490534 -4.849972,8.630913 -1.564935,3.140378 -2.512296,5.970567 -2.541116,6.106815 -0.02883,0.136245 0.02747,0.225257 0.02747,0.225257 l 0.09513,-0.03988 0.114813,-0.135159 c 0.02354,-0.07824 0.906476,-2.993792 3.055252,-6.976241 2.178001,-4.036611 5.863449,-9.841967 6.541291,-10.903436 0.67784,-1.061472 2.760816,-4.140359 2.874118,-4.450412 0.1133,-0.310051 0.194585,-0.946701 0.194585,-0.946701 z"
            style="opacity:1;fill:#86877f;fill-opacity:1;stroke:none;stroke-width:0.4;stroke-miterlimit:4;stroke-dasharray:none"
            id="path870" />
        <circle transform="rotate(-51.491358)" r="1.7071841" cy="46.047764" cx="-8.9854021" id="path942"
            style="display:inline;opacity:0.998;fill:url(#lg2);fill-opacity:1;stroke:none;stroke-width:0.4;stroke-miterlimit:4;stroke-dasharray:none" />
    </svg>
`;

const rockImgStr = `
<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100">
  <g transform="translate(-43.108626,-37.49516)">
    <path
       id="path891"
       d="m 56.088665,74.718402 c -6.424856,0.952413 -2.903857,-3.705667 -5.078121,-5.879931 -1.13909,-1.139089 -4.866521,-0.590208 -6.548104,-2.271792 -3.932349,-3.932348 3.778321,-14.23838 5.34539,-17.372517 0.667758,-1.335516 -0.02598,-4.080814 1.469983,-5.078122 6.22546,-4.150307 34.04993,-8.36564 40.090428,-5.34539 4.064854,2.032426 3.931436,5.131017 5.879931,6.548104 1.763098,1.282253 5.685538,1.482106 6.681738,3.474503 2.08472,4.169447 6.20997,13.206542 4.27631,18.040694 -0.60496,1.512403 -2.40542,2.326045 -2.40542,4.142676 0,5.003366 4.69013,11.363756 -0.80181,15.635266 -4.46203,3.470466 -9.486141,1.092851 -14.298923,2.405428 -3.582524,0.977053 -6.879171,2.767801 -10.423511,3.875408 -10.444692,3.263966 -13.621586,-6.563842 -18.8425,-12.828937 -1.813381,-2.176058 -6.209382,-2.32142 -5.345391,-5.34539 z"
       style="opacity:0.998;fill:#a9a9a9;fill-opacity:1;stroke:#000000;stroke-width:0.499999;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" />
    <path
       transform="matrix(0.26458333,0,0,0.26458333,0.0956995,0.01656885)"
       d="m 300.65234,143.16797 c -39.65487,2.51112 -91.53529,13.05868 -107.20898,23.50781 -5.65403,3.76935 -3.03088,14.14379 -5.55469,19.19141 -5.92278,11.84555 -35.06554,50.79774 -20.20312,65.66015 6.35559,6.3556 20.44282,4.28268 24.74804,8.58789 8.21769,8.2177 -5.08956,25.82233 19.19336,22.22266 -3.26547,11.42918 13.3494,11.97865 20.20313,20.20313 1.0535,1.2642 2.08088,2.57291 3.0957,3.90429 12.71226,-12.17948 22.00825,-28.27413 25.18945,-44.8164 2.37596,-12.35497 -1.51085,-25.78277 1.51368,-37.88086 3.79706,-15.18824 20.9912,-29.61544 28.28515,-43.43555 7.02915,-13.31839 8.2827,-26.13778 10.73828,-37.14453 z"
       style="opacity:0.998;fill:#848484;fill-opacity:1;stroke:none;stroke-width:1.88976;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
       id="path893" />
    <path
       transform="matrix(0.26458333,0,0,0.26458333,0.0956995,0.01656885)"
       d="m 344.76172,146.37891 c -3.24675,23.49986 -4.61659,46.05883 -1.18945,70.04882 4.98806,34.91648 -29.35916,88.12105 -6.65625,121.63868 1.82524,-0.60899 3.66456,-1.17805 5.52539,-1.68555 18.19004,-4.96092 37.1786,4.02492 54.04297,-9.0918 20.75693,-16.14429 3.03124,-40.18339 3.03124,-59.09375 10e-6,-6.866 6.80534,-9.94008 9.0918,-15.65625 7.30832,-18.27081 -8.2848,-52.427 -16.16406,-68.18554 -3.76517,-7.53032 -18.58828,-8.28651 -25.25195,-13.13282 -7.36439,-5.35592 -6.86139,-17.06643 -22.22461,-24.74804 -0.0648,-0.0324 -0.13895,-0.0618 -0.20508,-0.0937 z"
       style="opacity:0.998;fill:#c1c1c1;fill-opacity:1;stroke:none;stroke-width:1.88976;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
       id="path901" />
    <path
       style="opacity:0.998;fill:none;fill-opacity:1;stroke:#000000;stroke-width:0.499999;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
       d="m 56.088665,74.718402 c -6.424856,0.952413 -2.903857,-3.705667 -5.078121,-5.879931 -1.13909,-1.139089 -4.866521,-0.590208 -6.548104,-2.271792 -3.932349,-3.932348 3.778321,-14.23838 5.34539,-17.372517 0.667758,-1.335516 -0.02598,-4.080814 1.469983,-5.078122 6.22546,-4.150307 34.04993,-8.36564 40.090428,-5.34539 4.064854,2.032426 3.931436,5.131017 5.879931,6.548104 1.763098,1.282253 5.685538,1.482106 6.681738,3.474503 2.08472,4.169447 6.20997,13.206542 4.27631,18.040694 -0.60496,1.512403 -2.40542,2.326045 -2.40542,4.142676 0,5.003366 4.69013,11.363756 -0.80181,15.635266 -4.46203,3.470466 -9.486141,1.092851 -14.298923,2.405428 -3.582524,0.977053 -6.879171,2.767801 -10.423511,3.875408 -10.444692,3.263966 -13.621586,-6.563842 -18.8425,-12.828937 -1.813381,-2.176058 -6.209382,-2.32142 -5.345391,-5.34539 z"
       id="path899" />
  </g>
</svg>
`;

const paperImgStr = `
<svg width="25mm" height="25mm" version="1.1" viewBox="0 0 25 25" xmlns="http://www.w3.org/2000/svg" xmlns:cc="http://creativecommons.org/ns#" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<metadata>
<rdf:RDF>
<cc:Work rdf:about="">
<dc:format>image/svg+xml</dc:format>
<dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"/>
<dc:title/>
</cc:Work>
</rdf:RDF>
</metadata>
<g transform="translate(-3.7733 -5.7645)">
<path d="m5.1377 9.1445c0.33046 0.073488 0.79336-0.41013 1.1065-0.25357 0.062942 0.031476 0.35092 0.38674 0.39188 0.34578 0.082959-0.082962 0.027129-0.37291 0.11526-0.46104 0.047209-0.047209 0.38631 0 0.46104 0 1.1607 0 2.443-0.21499 3.5269-0.57629 0.07104-0.023677 0.20228 0.28181 0.20747 0.27662 0.07684-0.076839-0.0077-0.31504 0.06916-0.39188 0.26283-0.26283 1.885-0.083648 2.3513-0.16136 2.5104-0.41841 5.4011-0.78376 7.8837-0.78376-0.08331 0.34681 0.30688 0.5009 0.50714 0.96818 0.96375 1.7999 1.3062 4.2721 2.213 6.0857-0.33505 0.5156-0.42171 0.47629 0.06916 0.41493 0.38857 1.3232 0.8339 3.0835 1.4523 4.011-0.21269 0.31546-0.34184 0.2673 0.04609 0.32272 0.5948 1.9017 1.0288 3.8096 1.8902 5.5324 0.10101 0.20202 0.79438 1.0037 0.50714 1.2909-0.60645 0.60645-2.3951-0.0024-2.9506 0.55324-0.11929 0.11929-0.3187-0.37286-0.43798-0.25357-0.06909 0.06909-0.0224 0.32208-0.11526 0.41493-0.03976 0.03975-0.25839 0.01501-0.32273 0.02305-0.76812 0.09602-1.5389 0.29251-2.3052 0.48409-0.11866 0.02967-0.56249 0.06453-0.69156 0-0.06301-0.0315-0.16124-0.33431-0.27662-0.27662-0.09481 0.0474 0.0028 0.44474-0.11526 0.48409-0.72142 0.24048-1.5145 0.07454-2.2591 0.32273-2.0639 0.68798-4.4769 0.90371-6.4776 1.4753-0.33181-0.42262-0.33177-1.0003-0.6685-1.337-0.12731-0.12731 0.54224-0.21847 0.41493-0.34578-0.0429-0.0429-0.43297-0.09822-0.48409-0.11526-1.0431-3.042-2.0795-6.1718-2.9506-9.2207 0.2246-0.32606 0.23372-0.33562-0.15956-0.43393 0.28709-0.47356 0.46569-0.4238-0.1141-0.4238-0.72719-2.0552-1.1614-4.2299-2.1679-6.2429-0.25616-0.51232-0.634-1.1235-0.71652-1.7282z" fill="#fff" opacity=".998"/>
<g transform="matrix(.086249 0 0 .086249 4.7459 6.5857)" fill="none" stroke="#8ad8f6" stroke-width="1.3">
<path d="m59.294 190.88c61.719-7.2593 124.29-32.135 184.07-40.676" opacity=".998"/>
<path d="m63.926 203.5c37.331-2.0961 65.843-15.582 102.3-22.874 24.928-4.9855 57.42-9.1664 80.014-18.849" opacity=".998"/>
<path d="m56.014 179.63c17.018-2.2826 32.805-9.532 49.558-12.324 28.252-4.7087 55.505-13.615 83.522-18.709 11.148-2.0268 21.495-4.764 32.741-6.0136 5.2254-0.5806 12.448-3.52 17.428-4.765" opacity=".998"/>
<g transform="translate(-10.583 -36.664)">
<path d="m58.444 191.16c61.719-7.2593 122.21-31.379 181.99-39.92" opacity=".998"/>
<path d="m62.32 203.5c37.331-2.0961 67.449-15.582 103.91-22.874 24.928-4.9855 55.909-8.7884 78.502-18.471" opacity=".998"/>
<path d="m75.044 175.02c17.018-2.2826 13.775-4.9219 30.527-7.714 28.252-4.7087 55.505-13.615 83.522-18.709 11.148-2.0268 21.495-4.764 32.741-6.0136 5.2254-0.5806 9.9911-1.8191 14.971-3.0641" opacity=".998"/>
</g>
<g transform="translate(14.487 36.117)">
<path d="m64.399 203.41c37.331-2.0961 65.37-15.488 101.83-22.78 24.928-4.9855 55.247-9.0719 77.84-18.755" opacity=".998"/>
<path d="m53.462 180.01c17.018-2.2826 35.357-9.9099 52.109-12.702 28.252-4.7087 55.505-13.615 83.522-18.709 11.148-2.0268 21.495-4.764 32.741-6.0136 5.2254-0.5806 9.1406-1.8191 14.121-3.0641" opacity=".998"/>
<path d="m74.4 188.7c61.719-7.2593 105.59-29.206 165.37-37.746" opacity=".998"/>
</g>
<g transform="rotate(1.9741 3302.7 -843.35)">
<path d="m58.228 190.83c61.719-7.2593 122.27-30.726 182.05-39.266" opacity=".998"/>
<path d="m62.401 203.4c37.331-2.0961 67.407-15.284 103.83-22.771 24.923-5.123 55.039-11.05 77.72-18.189" opacity=".998"/>
<path d="m53.829 179.83c17.018-2.2826 34.99-9.7241 51.743-12.516 28.252-4.7087 55.505-13.615 83.522-18.709 11.148-2.0268 21.495-4.764 32.741-6.0136 5.2254-0.5806 9.263-1.9044 14.243-3.1494" opacity=".998"/>
</g>
<path d="m79.279 248.34c66.135-10.563 117.79-31.393 184.46-39.726" opacity=".998"/>
<g transform="rotate(.6371 6765.4 -1566.1)">
<path d="m55.415 191.3c61.719-7.2593 122.42-30.853 182.2-39.394" opacity=".998"/>
<path d="m62.031 203.35c37.331-2.0961 67.738-15.428 104.2-22.72 24.928-4.9855 51.309-7.7407 73.903-17.424" opacity=".998"/>
<path d="m51.379 180.27c17.018-2.2826 37.44-10.163 54.192-12.955 28.252-4.7087 55.505-13.615 83.522-18.709 11.148-2.0268 21.495-4.764 32.741-6.0136 5.2254-0.5806 6.5172-0.71571 11.497-1.9607" opacity=".998"/>
</g>
</g>
<path d="m7.4843 11.231c0.13874 0.0041 0.28849-0.0016 0.41565 0.04074 0.18034 0.06011 0.23569 0.16849 0.2771 0.33415 0.24239 0.96955-1.544 0.43564-1.0106-0.0978-0.1457-0.42156 0.18091-0.02768 0.20375-0.07335 0.055968-0.11194-0.15559-0.28081 0.1141-0.20375z" fill="none" opacity=".998" stroke="#000" stroke-width=".11212"/>
<path d="m8.2038 8.7436c2.7088 3.7934 2.4468 9.1245 4.4988 13.203 1.0317 2.0505 1.5745 4.973 2.074 6.4153" fill="none" opacity=".998" stroke="#ed1e26" stroke-width=".11212"/>
<path d="m10.93 26.196c0.2155-0.03556 0.43613-0.06045 0.65097-0.08732" fill="none" opacity=".998" stroke="#8ad8f6" stroke-width=".11212"/>
<path d="m11.783 25.388c0.11844-0.04794 0.27313-0.03462 0.39528-0.0041 0.26721 0.06681 0.32876 0.5433 0.13855 0.7335-0.09995 0.09995-0.27838 0.09092-0.36268 0.17522-0.0598 0.0598-0.24424-0.06703-0.28525-0.0978-0.32565-0.24424-0.15044-0.6179 0.1141-0.80686z" fill="none" opacity=".998" stroke="#000" stroke-width=".11212"/>
<path d="m8.5827 18.892c0.26548-5e-3 0.5513-0.08413 0.79989-0.15516" fill="none" opacity=".998" stroke="#8ad8f6" stroke-width=".11212"/>
<path d="m5.1377 9.1445c0.33046 0.073488 0.79336-0.41013 1.1065-0.25357 0.062942 0.031476 0.35092 0.38674 0.39188 0.34578 0.082959-0.082962 0.027129-0.37291 0.11526-0.46104 0.047209-0.047209 0.38631 0 0.46104 0 1.1607 0 2.443-0.21499 3.5269-0.57629 0.07104-0.023677 0.20228 0.28181 0.20747 0.27662 0.07684-0.076839-0.0077-0.31504 0.06916-0.39188 0.26283-0.26283 1.885-0.083648 2.3513-0.16136 2.5104-0.41841 5.4011-0.78376 7.8837-0.78376-0.08331 0.34681 0.30688 0.5009 0.50714 0.96818 0.96375 1.7999 1.3062 4.2721 2.213 6.0857-0.33505 0.5156-0.42171 0.47629 0.06916 0.41493 0.38857 1.3232 0.8339 3.0835 1.4523 4.011-0.21269 0.31546-0.34184 0.2673 0.04609 0.32272 0.5948 1.9017 1.0288 3.8096 1.8902 5.5324 0.10101 0.20202 0.79438 1.0037 0.50714 1.2909-0.60645 0.60645-2.3951-0.0024-2.9506 0.55324-0.11929 0.11929-0.3187-0.37286-0.43798-0.25357-0.06909 0.06909-0.0224 0.32208-0.11526 0.41493-0.03976 0.03975-0.25839 0.01501-0.32273 0.02305-0.76812 0.09602-1.5389 0.29251-2.3052 0.48409-0.11866 0.02967-0.56249 0.06453-0.69156 0-0.06301-0.0315-0.16124-0.33431-0.27662-0.27662-0.09481 0.0474 0.0028 0.44474-0.11526 0.48409-0.72142 0.24048-1.5145 0.07454-2.2591 0.32273-2.0639 0.68798-4.4769 0.90371-6.4776 1.4753-0.33181-0.42262-0.33177-1.0003-0.6685-1.337-0.12731-0.12731 0.54224-0.21847 0.41493-0.34578-0.0429-0.0429-0.43297-0.09822-0.48409-0.11526-1.0431-3.042-2.0795-6.1718-2.9506-9.2207 0.2246-0.32606 0.23372-0.33562-0.15956-0.43393 0.28709-0.47356 0.46569-0.4238-0.1141-0.4238-0.72719-2.0552-1.1614-4.2299-2.1679-6.2429-0.25616-0.51232-0.634-1.1235-0.71652-1.7282z" fill="none" opacity=".998" stroke="#000" stroke-width=".11212"/>
<path d="m9.2871 18.538c-0.011795-0.61102 1.1747-0.39371 1.0373 0.1556-0.088668 0.35466-0.441 0.35246-0.72037 0.25933-0.12953-0.043181-0.2597-0.30041-0.31696-0.41493z" fill="none" opacity=".998" stroke="#000" stroke-width=".11212"/>
</g>
</svg>
`;

/** returns an image object from a string */
function getImgFromStr(str) {
    const scissorImage = new Image();
    scissorImage.src = 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(str);
    return scissorImage;
}

window.addEventListener('load', function() {
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = 800;
    canvas.height = 800;

    ctx.fillStyle = 'white';
    ctx.lineWidth = 3;
    ctx.strokeStyle = 'red';

    class Entity {
        constructor(game, configs) {
            const {
                type,
                image,
                spriteWidth,
                spriteHeight,
                initX,
                initY,
                collisionRadius,
                // difference between the collision position and sprite
                collisionOffsetX, 
                collisionOffsetY,
                speed
            } = configs;

            this.game = game;
            this.type = type;
            this.image = image;
            this.spriteWidth = spriteWidth;
            this.spriteHeight = spriteHeight;
            this.spriteX = initX;
            this.spriteY = initY;
            this.collisionX = this.spriteX + this.spriteWidth * 0.5 + collisionOffsetX;
            this.collisionY = this.spriteY + this.spriteHeight * 0.5 + collisionOffsetY,
            this.collisionRadius = collisionRadius;
            this.speed = speed;
            this.isPlayer = false; // DEBUG
        }

        draw(ctx, dt) {
            ctx.drawImage(
                this.image,
                this.spriteX,
                this.spriteY,
                this.spriteWidth,
                this.spriteHeight
            );

            if(this.game.debug) {
                ctx.beginPath();
                ctx.arc(
                    this.collisionX,
                    this.collisionY,
                    this.collisionRadius,
                    0,
                    Math.PI * 2
                );
                ctx.save();
                ctx.globalAlpha = 0.3;
                if(this.isPlayer) {
                    ctx.strokeStyle = 'blue';
                }
                ctx.stroke();
                ctx.fill();
                ctx.restore();
            }
        }

        setPlayer() {
            this.isPlayer = true;
        }

        update(dt) {
            const prey = this.game.getNearestPrey(this);
            const predator = this.game.getNearestPredator(this);
            if(!prey && !predator) {
                return;
            } else if(!predator) {
                this.moveToEntity(prey, dt);
            } else if(!prey) {
                this.moveAwayFromEntity(predator, dt);
            } else if (this.getDistance(prey) < this.getDistance(predator)) {
                this.moveToEntity(prey, dt);
            } else {
                this.moveAwayFromEntity(predator, dt);
            }
        }

        // returns distance to other entity
        getDistance(entity) {
            return this.game.getCollisionDistance(this, entity);
        }

        moveUp() {
            if(this.collisionY > this.game.margin) {
                this.spriteY -= this.speed;
                this.collisionY -= this.speed;
            }
        }
        
        moveDown() {
            if(this.collisionY < this.game.height - this.game.margin) {
                this.spriteY += this.speed;
                this.collisionY += this.speed;
            }
        }

        moveLeft() {
            if(this.collisionX > this.game.margin) {
                this.spriteX -= this.speed;
                this.collisionX -= this.speed;
            }
        }
        
        moveRight() {
            if(this.collisionX < this.game.width - this.game.margin) {
                this.spriteX += this.speed;
                this.collisionX += this.speed;
            }
        }

        // returns true if the x and y position is outside of the game margin
        isOutsideMargin(x, y) {
            return x < this.game.margin 
                || x > this.game.width - this.game.margin
                || y < this.game.margin
                || y > this.game.height - this.game.margin
            ;
        }

        // returns true if that new position would collide
        // with a friendly entity
        collidesWithFriendly(x, y) {
            const nearestEntity = this.getNearestEntity();
            const dx = nearestEntity.collisionX - x;
            const dy = nearestEntity.collisionY - y;
            const dist = Math.hypot(dy, dx);
            return dist <= nearestEntity.collisionRadius + this.collisionRadius;
        }

        // returns true if we can move to this new position
        canMove(x,y) {
            return !this.isOutsideMargin(x,y) && !this.collidesWithFriendly(x,y);
        }

        // move one increment to other entity
        moveToEntity(entity, dt) {
            const a = entity;
            const b = this;
            const dx = a.collisionX - b.collisionX;
            const dy = a.collisionY - b.collisionY;
            const dist = Math.hypot(dx, dy);
            const increment = this.speed * dt;

            // get normalized dx and dy, relative to our speed
            const normDx = increment * (dx / dist);
            const normDy = increment * (dy / dist);

            // don't move if we are on the edge
            // TODO: might get stuck in the corner
            if(!this.isOutsideMargin(this.collisionX + normDx, this.collisionY)) {
                this.collisionX += normDx;
                this.spriteX += normDx;
            }

            if(!this.isOutsideMargin(this.collisionX, this.collisionY + normDy)) {
                this.collisionY += normDy;
                this.spriteY += normDy;
            }
        }

        moveAwayFromEntity(entity, dt) {
            const a = entity;
            const b = this;
            const dx = a.collisionX - b.collisionX;
            const dy = a.collisionY - b.collisionY;
            const dist = Math.hypot(dx, dy);
            const increment = -this.speed * dt;

            // get normalized dx and dy, relative to our speed
            const normDx = increment * (dx / dist);
            const normDy = increment * (dy / dist);

            // don't move if we are on the edge
            // TODO: might get stuck in the corner
            if(this.canMove(this.collisionX + normDx, this.collisionY)) {
                this.collisionX += normDx;
                this.spriteX += normDx;
            }

            if(this.canMove(this.collisionX, this.collisionY + normDy)) {
                this.collisionY += normDy;
                this.spriteY += normDy;
            }
        }

        getNearestEntity() {
            return this.game.getNearestEntity(this);
        }
    }

    // TODO game over
    class Game {
        constructor(canvas) {
            this.canvas = canvas;
            this.width = this.canvas.width;
            this.height = this.canvas.height;

            this.initPlayers = 5; // initial num players of each type
            this.numPlayers = 0;

            this.scissors = []
            this.rocks = [];
            this.papers = [];

            this.drawItems = [];
            this.entities = [];
            this.debug = true;
            this.margin = 30;

            // number of attempts to get entity onto the screen
            // without colliding with other item
            this.attempts = 20;

            window.addEventListener('keydown', e => {
                if(e.code == 'KeyA' || e.code == 'ArrowLeft') {
                    this.scissors[0].moveLeft();                    
                } else if(e.code == 'KeyS' || e.code == 'ArrowDown') {
                    this.scissors[0].moveDown();                    
                } else if(e.code == 'KeyD' || e.code == 'ArrowRight') {
                    this.scissors[0].moveRight();                    
                } else if(e.code == 'KeyW' || e.code == 'ArrowUp') {
                    this.scissors[0].moveUp();
                }

                if(e.key == ';') {
                    this.scissors[0].moveToPrey()
                }

                if(e.key == 'd') {
                    this.debug = !this.debug;
                }
            })
        }

        // dt = time since last render
        render(ctx, dt) {
            this.entities.forEach(item => item.update(dt));
            this.entities.forEach(entity => entity.draw(ctx, dt));

            const deathArr = [];
            // check for collisions (brute force for now)
            for(let entityA of this.entities) {
                for(let entityB of this.entities) {
                    if(entityA !== entityB && this.checkCollision(entityA, entityB)) {
                        const victim = this.getVictim(entityA, entityB);
                        if(victim != null) {
                            console.log('death!');
                            deathArr.push(victim);
                        }
                    }
                }
            }

            const removeDead = arr => arr.filter(entityA => !deathArr.some(entityB => entityA === entityB))
            // remove dead entities
            this.entities = removeDead(this.entities);
            this.rocks = removeDead(this.rocks);
            this.papers = removeDead(this.papers);
            this.scissors = removeDead(this.scissors);
        }

        // returns the loser on a collision between two entities
        getVictim(a, b) {
            if(a.type == 'scissors' && b.type == 'rock') {
                return a;
            } else if(a.type == 'rock' && b.type == 'paper') {
                return a;
            } else if(a.type == 'paper' && b.type == 'scissors') {
                return a;
            } else {
                return null;
            }
        }

        // returns true if a and b are friendly
        isFriendly(a, b) {
            return (a.type == 'scissors' && b.type == 'rock')
                || (a.type == 'rock' && b.type == 'paper')
                || (a.type == 'paper' && b.type == 'scissors')
            ;
        }
        
        // returns the distance between the center of a and b
        getCollisionDistance(a, b) {
            const dx = a.collisionX - b.collisionX;
            const dy = a.collisionY - b.collisionY;
            const dist = Math.hypot(dy, dx);
            return dist;
        }

        // returns true if a collided with b
        checkCollision(a, b) {
            return this.getCollisionDistance(a, b) <= a.collisionRadius + b.collisionRadius;
        }

        // returns true if entities a and b are closer than a buffer distance
        areInsideBuffer(a, b, buffer) {
            return this.getCollisionDistance(a, b) <= a.collisionRadius + b.collisionRadius + buffer;
        }

        // returns true if entity is outside of the page margin
        isOutsideMargin(entity) {
            return entity.collisionX < this.margin 
                || entity.collisionX > this.width - this.margin
                || entity.collisionY < this.margin
                || entity.collisionY > this.height - this.margin
            ;
        }

        // returns true if the new item is within a margin distance of another entity
        isTooClose(newItem, items, buffer) {
            for(let item of items) {
                if(newItem === item) {
                    continue;
                } else if (this.areInsideBuffer(newItem, item, buffer)) {
                    return true;
                } else if (this.isOutsideMargin(newItem)) {
                    return true;
                }
            }
        }

        // creates a new entity using the createFunction
        // and attempts to add it to the map assuming it isn't too close
        // to any other entity
        addEntityAttempt(entityArr, createFn) {
            for(let i = 0; i < this.attempts; i++) {
                const newEntity = createFn();
                if(this.isTooClose(newEntity, this.entities, this.margin)) {
                    continue;
                } else {
                    entityArr.push(newEntity);
                    this.entities.push(newEntity);
                    break;
                }
            }
        }

        // returns the nearest entity to entities in arr
        // (TODO: could be more efficient)
        getNearestFromArr(entity, arr) {
            let nearestEntity = null;
            let nearestDistance = null;
            for(let otherEntity of arr) {
                const distance = this.getCollisionDistance(entity, otherEntity);
                if(nearestEntity == null || distance < nearestDistance) {
                    nearestEntity = otherEntity;
                    nearestDistance = distance;
                }
            }
            return nearestEntity
        }

        // returns the absolute nearest entity
        getNearestEntity(entity) {
            return this.getNearestFromArr(entity, this.entities);
        }
        
        // returns the position of the nearest predator of entity
        getNearestPredator(entity) {
            if(entity.type == 'scissors') {
                return this.getNearestFromArr(entity, this.rocks);
            } else if(entity.type == 'rock') {
                return this.getNearestFromArr(entity, this.papers);
            } else if(entity.type == 'paper') {
                return this.getNearestFromArr(entity, this.scissors);
            }
        }
        
        // returns the position of the nearest prey of entity
        getNearestPrey(entity) {
            if(entity.type == 'scissors') {
                return this.getNearestFromArr(entity, this.papers);
            } else if(entity.type == 'rock') {
                return this.getNearestFromArr(entity, this.scissors);
            } else if(entity.type == 'paper') {
                return this.getNearestFromArr(entity, this.rocks);
            }
        }

        init() {
            const defaultSpeed = .03; // TODO add to main configs
            const defaultRadius = 25;
            // functions to get random X and Y positions within margin
            const getX = () => Math.random() * (this.width - this.margin*2) - this.margin;
            const getY = () => Math.random() * (this.height - this.margin*2) - this.margin;

            // add one of each type of player for each loop cycle
            for(let i = 0; i < this.initPlayers; i++) {
                this.addEntityAttempt(this.scissors, () => new Entity(this, {
                    type: "scissors",
                    image: getImgFromStr(scissorImgStr),
                    spriteWidth: 200,
                    spriteHeight: 100,
                    initX: getX(),
                    initY: getY(),
                    collisionOffsetX: -45,
                    collisionOffsetY: 10,
                    collisionRadius: defaultRadius,
                    speed: defaultSpeed,
                }));

                this.addEntityAttempt(this.rocks, () => new Entity(this, {
                    type: "rock",
                    image: getImgFromStr(rockImgStr),
                    spriteWidth: 100,
                    spriteHeight: 100,
                    initX: getX(),
                    initY: getY(),
                    collisionOffsetX: -15,
                    collisionOffsetY: -20,
                    collisionRadius: defaultRadius,
                    speed: defaultSpeed,
                }));

                this.addEntityAttempt(this.papers, () => new Entity(this, {
                    type: "paper",
                    image: getImgFromStr(paperImgStr),
                    spriteWidth: 70,
                    spriteHeight: 70,
                    initX: getX(),
                    initY: getY(),
                    collisionRadius: 25,
                    collisionOffsetX: 0,
                    collisionOffsetY: 0,
                    speed: defaultSpeed,
                }));
            }

            this.scissors[0].setPlayer(); // DEBUG
        }
    }

    const game = new Game(canvas);
    game.init();
    console.log(game);

    let prevTime = 0;
    function animate(time) {
        const dt = time - prevTime;
        prevTime = time;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        game.render(ctx, dt);
        requestAnimationFrame(animate);
    }

    animate(0);
});